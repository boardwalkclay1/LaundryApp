<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Laundry Bubbles – App Shell</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: #05020c; color: #f5f2ff; }

  #app {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  header {
    flex: 0 0 auto;
    padding: 10px 14px;
    display: flex;
    gap: 10px;
    align-items: center;
    background:
      radial-gradient(circle at 0% 0%, rgba(160,130,255,0.6) 0, transparent 55%),
      radial-gradient(circle at 100% 0%, rgba(110,220,255,0.5) 0, transparent 55%),
      linear-gradient(to right, #060419, #0b0626);
    border-bottom: 1px solid rgba(255,255,255,0.07);
    box-shadow: 0 4px 25px rgba(0,0,0,0.7);
  }

  #brand {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  #brand-icon {
    width: 24px;
    height: 24px;
    border-radius: 35%;
    background:
      radial-gradient(circle at 30% 30%, #ffffff 0, #f7f6ff 25%, #d9d2ff 50%, #937dff 80%, #23145d 100%);
    box-shadow: 0 0 15px rgba(150,130,255,0.95);
    position: relative;
  }
  #brand-icon::after {
    content: "";
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,0.95);
    top: 50%; left: 50%; transform: translate(-50%,-50%);
  }
  #brand-text {
    display: flex;
    flex-direction: column;
  }
  #brand-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }
  #brand-subtitle {
    font-size: 11px;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: #b9b3ff;
  }

  header nav {
    display: flex;
    gap: 6px;
    margin-left: 18px;
  }

  .nav-btn {
    border-radius: 999px;
    padding: 5px 10px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    background: rgba(12,8,40,0.7);
    border: 1px solid rgba(255,255,255,0.15);
    cursor: pointer;
    color: #f4f3ff;
    transition: background 0.12s, box-shadow 0.12s, transform 0.12s;
  }
  .nav-btn.active,
  .nav-btn:hover {
    background: rgba(150,120,255,0.95);
    box-shadow: 0 0 12px rgba(155,125,255,0.85);
    transform: translateY(-1px);
  }

  #main {
    flex: 1 1 auto;
    display: flex;
    min-height: 0;
  }

  #left-panel {
    flex: 0 0 340px;
    max-width: 360px;
    background:
      radial-gradient(circle at 0% 100%, rgba(145,110,255,0.5) 0, transparent 55%),
      linear-gradient(to bottom, #0b0626, #050214);
    border-right: 1px solid rgba(255,255,255,0.07);
    padding: 10px 10px 10px 12px;
    overflow-y: auto;
  }

  #map-panel {
    flex: 1 1 auto;
    position: relative;
    padding: 10px;
  }

  #map-iframe {
    width: 100%;
    height: 100%;
    border-radius: 20px;
    border: 0;
    box-shadow:
      0 24px 34px rgba(0,0,0,0.9),
      0 0 0 1px rgba(255,255,255,0.06);
    background: #02000b;
  }

  .panel {
    display: none;
  }
  .panel.active {
    display: block;
  }

  .panel h2 {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.13em;
    color: #c9c3ff;
    margin: 10px 0 6px;
  }

  .field {
    margin-bottom: 8px;
  }
  .field label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.11em;
    color: #a8a0ff;
    display: block;
    margin-bottom: 2px;
  }
  .field input,
  .field textarea,
  .field select {
    width: 100%;
    border-radius: 10px;
    border: 1px solid rgba(220,210,255,0.4);
    padding: 6px 8px;
    font-size: 12px;
    background: rgba(10,6,40,0.9);
    color: #f5f2ff;
  }
  .field textarea {
    resize: vertical;
    min-height: 50px;
  }

  .inline-fields {
    display: flex;
    gap: 6px;
  }
  .inline-fields .field { flex: 1; }

  .small {
    font-size: 11px;
    color: #d0cbff;
  }

  .btn-primary {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 6px 10px;
    font-size: 12px;
    background: rgba(150,120,255,1);
    color: #fdfbff;
    cursor: pointer;
    margin-top: 8px;
    width: 100%;
  }

  .pill {
    border-radius: 999px;
    padding: 3px 7px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    border: 1px solid rgba(255,255,255,0.22);
    background: rgba(12,8,40,0.8);
    display: inline-block;
    margin-top: 4px;
  }

  #price-summary {
    margin-top: 6px;
    font-size: 12px;
    color: #f7f5ff;
  }

  #favorites-list {
    font-size: 12px;
    margin-top: 4px;
  }
  #favorites-list div {
    padding: 4px 6px;
    border-radius: 8px;
    background: rgba(18,12,55,0.8);
    margin-bottom: 3px;
  }

  #status {
    position: absolute;
    left: 18px;
    bottom: 18px;
    padding: 6px 9px;
    font-size: 11px;
    border-radius: 999px;
    background: rgba(6,4,25,0.9);
    color: #e8e3ff;
    border: 1px solid rgba(206,195,255,0.35);
    backdrop-filter: blur(8px);
  }
  #status strong { color: #b3a6ff; }
</style>
</head>
<body>
<div id="app">
  <header>
    <div id="brand">
      <div id="brand-icon"></div>
      <div id="brand-text">
        <div id="brand-title">Laundry Bubbles</div>
        <div id="brand-subtitle">COSMIC WASH NETWORK</div>
      </div>
    </div>
    <nav>
      <button class="nav-btn active" data-panel="profile-panel">Profile</button>
      <button class="nav-btn" data-panel="pricing-panel">Pricing</button>
      <button class="nav-btn" data-panel="job-panel">New Job</button>
      <button class="nav-btn" data-panel="webrtc-panel">Connect</button>
      <button class="nav-btn" data-panel="favorites-panel">Favorites</button>
      <button class="nav-btn" data-panel="settings-panel">Settings</button>
    </nav>
  </header>

  <div id="main">
    <div id="left-panel">
      <!-- Profile panel -->
      <div class="panel active" id="profile-panel">
        <h2>Profile</h2>
        <div class="field">
          <label>Role</label>
          <select id="role">
            <option value="client">Client</option>
            <option value="washer">Washer</option>
          </select>
        </div>
        <div class="field">
          <label>Name</label>
          <input id="name" type="text" placeholder="Your name" />
        </div>
        <div class="field">
          <label>Email</label>
          <input id="email" type="email" placeholder="you@example.com" />
        </div>
        <div class="field">
          <label>Phone</label>
          <input id="phone" type="tel" placeholder="Optional" />
        </div>
        <div class="field">
          <label>Bio</label>
          <textarea id="bio" placeholder="Describe your wash style / needs"></textarea>
        </div>
        <div class="field">
          <label>Photos of your work</label>
          <input id="photos-input" type="file" multiple accept="image/*" />
          <div class="small">Add clean fold shots, setups, etc. (Local only for now.)</div>
        </div>
        <button class="btn-primary" id="save-profile-btn">Save profile locally</button>
      </div>

      <!-- Pricing panel -->
      <div class="panel" id="pricing-panel">
        <h2>Pricing</h2>
        <div class="inline-fields">
          <div class="field">
            <label>Per pound ($)</label>
            <input id="price-per-pound" type="number" step="0.01" />
          </div>
          <div class="field">
            <label>Pickup fee ($)</label>
            <input id="pickup-fee" type="number" step="0.01" />
          </div>
        </div>
        <div class="inline-fields">
          <div class="field">
            <label>Folding fee ($)</label>
            <input id="folding-fee" type="number" step="0.01" />
          </div>
          <div class="field">
            <label>Avg turnaround (hrs)</label>
            <input id="turnaround" type="number" step="1" />
          </div>
        </div>

        <h2>Payment methods</h2>
        <div class="field">
          <label>PayPal link</label>
          <input id="paypal-link" type="text" placeholder="https://paypal.me/yourname" />
        </div>
        <div class="field">
          <label>Cash App</label>
          <input id="cashapp" type="text" placeholder="$Cashtag" />
        </div>
        <div class="field">
          <label>Zelle</label>
          <input id="zelle" type="text" placeholder="Email or phone" />
        </div>

        <button class="btn-primary" id="save-pricing-btn">Save pricing & payouts</button>
      </div>

      <!-- Job panel -->
      <div class="panel" id="job-panel">
        <h2>New Job</h2>
        <span class="pill">Both sides pay $1 safety check via PayPal</span>
        <div class="field">
          <label>Estimated weight (lbs)</label>
          <input id="job-weight" type="number" step="0.1" />
        </div>
        <div class="field">
          <label>Include pickup?</label>
          <select id="job-include-pickup">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <div class="field">
          <label>Include folding?</label>
          <select id="job-include-folding">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>

        <div id="price-summary">
          Total: <strong id="job-total">$0.00</strong>
          <div class="small" id="job-breakdown"></div>
        </div>

        <button class="btn-primary" id="calculate-job-btn">Calculate total</button>
        <button class="btn-primary" id="pay-dollar-btn">Pay $1 safety check (PayPal)</button>

        <h2>Proof photos</h2>
        <div class="field">
          <label>Pickup photos</label>
          <input id="job-photo-pickup" type="file" multiple accept="image/*" />
        </div>
        <div class="field">
          <label>Dropoff photos</label>
          <input id="job-photo-dropoff" type="file" multiple accept="image/*" />
        </div>
      </div>

      <!-- WebRTC panel -->
      <div class="panel" id="webrtc-panel">
        <h2>Connect (WebRTC)</h2>
        <div class="small">
          Step 1: Start a connection. Step 2: send the code via email. Step 3: paste their reply.
        </div>
        <div class="field">
          <label>Your connection code (offer/answer)</label>
          <textarea id="webrtc-local" readonly></textarea>
        </div>
        <button class="btn-primary" id="webrtc-create-offer-btn">Create connection offer</button>
        <button class="btn-primary" id="webrtc-create-answer-btn">Create answer from pasted offer</button>
        <div class="field">
          <label>Paste remote code here</label>
          <textarea id="webrtc-remote"></textarea>
        </div>
        <button class="btn-primary" id="webrtc-apply-remote-btn">Apply remote code</button>

        <h2>Email share</h2>
        <div class="field">
          <label>Partner email</label>
          <input id="webrtc-partner-email" type="email" placeholder="partner@example.com" />
        </div>
        <button class="btn-primary" id="webrtc-email-btn">Open email with prefilled code</button>
      </div>

      <!-- Favorites -->
      <div class="panel" id="favorites-panel">
        <h2>Favorites</h2>
        <div class="small">Clients can keep a list of favorite washers.</div>
        <div class="field">
          <label>Add washer ID</label>
          <input id="favorite-washer-id" type="text" placeholder="Washer user ID" />
        </div>
        <button class="btn-primary" id="add-favorite-btn">Add to favorites</button>
        <div id="favorites-list"></div>
      </div>

      <!-- Settings / safety -->
      <div class="panel" id="settings-panel">
        <h2>Safety & Settings</h2>
        <div class="field">
          <label><input type="checkbox" id="notif-email" /> Email notifications</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="notif-sms" /> SMS notifications</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="accept-terms" /> I agree to the terms & conditions</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="accept-disclosures" /> I understand this is peer-to-peer and I am responsible for my own safety</label>
        </div>
        <div class="small">
          You’ll want a full **terms, privacy, and risk disclosure** page in the production version,
          explaining responsibilities, no guarantees, and dispute handling.
        </div>
        <button class="btn-primary" id="save-settings-btn">Save settings</button>
      </div>
    </div>

    <div id="map-panel">
      <iframe id="map-iframe" src="https://boardwalkclay1.github.io/Map/" loading="lazy"></iframe>
      <div id="status"><strong>Status:</strong> App shell loaded.</div>
    </div>
  </div>
</div>

<script>
  // ===== Simple app state (local only for now) =====
  const state = {
    profile: null,
    favorites: [],
    settings: {
      notificationsEmail: true,
      notificationsSMS: false,
      acceptTerms: false,
      acceptDisclosures: false
    },
    pricing: {
      perPound: 0,
      pickupFee: 0,
      foldingFee: 0,
      avgTurnaroundHours: 24,
      paypalLink: '',
      cashapp: '',
      zelle: ''
    }
  };

  const statusEl = document.getElementById('status');

  function setStatus(msg) {
    statusEl.innerHTML = '<strong>Status:</strong> ' + msg;
  }

  // ===== Panel navigation =====
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const panelId = btn.getAttribute('data-panel');
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.getElementById(panelId).classList.add('active');
    });
  });

  // ===== Profile save/load =====
  const roleEl = document.getElementById('role');
  const nameEl = document.getElementById('name');
  const emailEl = document.getElementById('email');
  const phoneEl = document.getElementById('phone');
  const bioEl = document.getElementById('bio');

  document.getElementById('save-profile-btn').addEventListener('click', () => {
    state.profile = {
      id: 'user-' + (state.profile?.id || Math.random().toString(36).slice(2)),
      role: roleEl.value,
      name: nameEl.value,
      email: emailEl.value,
      phone: phoneEl.value,
      bio: bioEl.value
    };
    localStorage.setItem('lb_profile', JSON.stringify(state.profile));
    setStatus('Profile saved locally.');
  });

  function loadProfile() {
    const saved = localStorage.getItem('lb_profile');
    if (!saved) return;
    state.profile = JSON.parse(saved);
    roleEl.value = state.profile.role || 'client';
    nameEl.value = state.profile.name || '';
    emailEl.value = state.profile.email || '';
    phoneEl.value = state.profile.phone || '';
    bioEl.value = state.profile.bio || '';
  }

  // ===== Pricing & payment methods =====
  const perPoundEl = document.getElementById('price-per-pound');
  const pickupFeeEl = document.getElementById('pickup-fee');
  const foldingFeeEl = document.getElementById('folding-fee');
  const turnaroundEl = document.getElementById('turnaround');
  const paypalLinkEl = document.getElementById('paypal-link');
  const cashappEl = document.getElementById('cashapp');
  const zelleEl = document.getElementById('zelle');

  document.getElementById('save-pricing-btn').addEventListener('click', () => {
    state.pricing = {
      perPound: parseFloat(perPoundEl.value || '0'),
      pickupFee: parseFloat(pickupFeeEl.value || '0'),
      foldingFee: parseFloat(foldingFeeEl.value || '0'),
      avgTurnaroundHours: parseFloat(turnaroundEl.value || '24'),
      paypalLink: paypalLinkEl.value,
      cashapp: cashappEl.value,
      zelle: zelleEl.value
    };
    localStorage.setItem('lb_pricing', JSON.stringify(state.pricing));
    setStatus('Pricing and payout info saved.');
  });

  function loadPricing() {
    const saved = localStorage.getItem('lb_pricing');
    if (!saved) return;
    Object.assign(state.pricing, JSON.parse(saved));
    perPoundEl.value = state.pricing.perPound || '';
    pickupFeeEl.value = state.pricing.pickupFee || '';
    foldingFeeEl.value = state.pricing.foldingFee || '';
    turnaroundEl.value = state.pricing.avgTurnaroundHours || '';
    paypalLinkEl.value = state.pricing.paypalLink || '';
    cashappEl.value = state.pricing.cashapp || '';
    zelleEl.value = state.pricing.zelle || '';
  }

  // ===== Job pricing calculation =====
  const weightEl = document.getElementById('job-weight');
  const includePickupEl = document.getElementById('job-include-pickup');
  const includeFoldingEl = document.getElementById('job-include-folding');
  const jobTotalEl = document.getElementById('job-total');
  const jobBreakdownEl = document.getElementById('job-breakdown');

  document.getElementById('calculate-job-btn').addEventListener('click', () => {
    const weight = parseFloat(weightEl.value || '0');
    const perPound = state.pricing.perPound || 0;
    const pickupFee = includePickupEl.value === 'yes' ? (state.pricing.pickupFee || 0) : 0;
    const foldingFee = includeFoldingEl.value === 'yes' ? (state.pricing.foldingFee || 0) : 0;

    const perPoundTotal = weight * perPound;
    const subtotal = perPoundTotal + pickupFee + foldingFee;
    const total = subtotal;

    jobTotalEl.textContent = '$' + total.toFixed(2);
    jobBreakdownEl.textContent =
      `${weight.toFixed(1)} lbs × $${perPound.toFixed(2)} + pickup $${pickupFee.toFixed(2)} + folding $${foldingFee.toFixed(2)}`;
    setStatus('Job total calculated.');
  });

  // ===== $1 safety PayPal link (placeholder) =====
  document.getElementById('pay-dollar-btn').addEventListener('click', () => {
    // Use the washer's PayPal link OR your platform PayPal link
    const link = state.pricing.paypalLink || 'https://www.paypal.com'; // replace with your actual $1 link
    window.open(link, '_blank');
    setStatus('Opened PayPal for $1 safety check (both client & washer should do this).');
  });

  // ===== Favorites =====
  const favoriteInputEl = document.getElementById('favorite-washer-id');
  const favoritesListEl = document.getElementById('favorites-list');

  document.getElementById('add-favorite-btn').addEventListener('click', () => {
    const id = favoriteInputEl.value.trim();
    if (!id) return;
    if (!state.favorites.includes(id)) {
      state.favorites.push(id);
      localStorage.setItem('lb_favorites', JSON.stringify(state.favorites));
      renderFavorites();
      favoriteInputEl.value = '';
      setStatus('Washer saved to favorites.');
    }
  });

  function renderFavorites() {
    favoritesListEl.innerHTML = '';
    state.favorites.forEach(id => {
      const div = document.createElement('div');
      div.textContent = 'Washer ID: ' + id;
      favoritesListEl.appendChild(div);
    });
  }

  function loadFavorites() {
    const saved = localStorage.getItem('lb_favorites');
    if (!saved) return;
    state.favorites = JSON.parse(saved);
    renderFavorites();
  }

  // ===== Settings =====
  const notifEmailEl = document.getElementById('notif-email');
  const notifSmsEl = document.getElementById('notif-sms');
  const acceptTermsEl = document.getElementById('accept-terms');
  const acceptDisclosuresEl = document.getElementById('accept-disclosures');

  document.getElementById('save-settings-btn').addEventListener('click', () => {
    state.settings = {
      notificationsEmail: notifEmailEl.checked,
      notificationsSMS: notifSmsEl.checked,
      acceptTerms: acceptTermsEl.checked,
      acceptDisclosures: acceptDisclosuresEl.checked
    };
    localStorage.setItem('lb_settings', JSON.stringify(state.settings));
    setStatus('Settings saved locally. Make sure terms and disclosures are clear in production.');
  });

  function loadSettings() {
    const saved = localStorage.getItem('lb_settings');
    if (!saved) return;
    Object.assign(state.settings, JSON.parse(saved));
    notifEmailEl.checked = state.settings.notificationsEmail;
    notifSmsEl.checked = state.settings.notificationsSMS;
    acceptTermsEl.checked = state.settings.acceptTerms;
    acceptDisclosuresEl.checked = state.settings.acceptDisclosures;
  }

  // ===== WebRTC shell (email-based exchange, data channel only) =====
  let rtcPeer = null;
  let dataChannel = null;

  const webrtcLocalEl = document.getElementById('webrtc-local');
  const webrtcRemoteEl = document.getElementById('webrtc-remote');
  const webrtcPartnerEmailEl = document.getElementById('webrtc-partner-email');

  async function createPeer(isInitiator) {
    rtcPeer = new RTCPeerConnection({ iceServers: [] });

    if (isInitiator) {
      dataChannel = rtcPeer.createDataChannel('laundry-bubbles');
      hookDataChannel(dataChannel);
    } else {
      rtcPeer.ondatachannel = (event) => {
        dataChannel = event.channel;
        hookDataChannel(dataChannel);
      };
    }

    rtcPeer.onicecandidate = () => {
      // In this flow, we use the final SDP only (no trickle ICE).
      // Users exchange the final code via email.
      updateLocalCode();
    };
  }

  function hookDataChannel(channel) {
    channel.onopen = () => {
      setStatus('WebRTC channel open. You can now send real-time messages between client and washer.');
    };
    channel.onmessage = (event) => {
      // Here you can handle location updates, status, etc.
      console.log('WebRTC message:', event.data);
    };
  }

  async function updateLocalCode() {
    if (!rtcPeer.localDescription) return;
    const bundle = {
      sdp: rtcPeer.localDescription
    };
    webrtcLocalEl.value = JSON.stringify(bundle);
  }

  document.getElementById('webrtc-create-offer-btn').addEventListener('click', async () => {
    await createPeer(true);
    const offer = await rtcPeer.createOffer();
    await rtcPeer.setLocalDescription(offer);
    await updateLocalCode();
    setStatus('WebRTC offer created. Email this code to your partner.');
  });

  document.getElementById('webrtc-create-answer-btn').addEventListener('click', async () => {
    const remoteTxt = webrtcRemoteEl.value.trim();
    if (!remoteTxt) return;
    const remote = JSON.parse(remoteTxt);
    await createPeer(false);
    await rtcPeer.setRemoteDescription(new RTCSessionDescription(remote.sdp));
    const answer = await rtcPeer.createAnswer();
    await rtcPeer.setLocalDescription(answer);
    await updateLocalCode();
    setStatus('WebRTC answer created. Email this code back to your partner.');
  });

  document.getElementById('webrtc-apply-remote-btn').addEventListener('click', async () => {
    const remoteTxt = webrtcRemoteEl.value.trim();
    if (!remoteTxt || !rtcPeer) return;
    const remote = JSON.parse(remoteTxt);
    await rtcPeer.setRemoteDescription(new RTCSessionDescription(remote.sdp));
    setStatus('Remote code applied. WebRTC should complete soon.');
  });

  document.getElementById('webrtc-email-btn').addEventListener('click', () => {
    const to = encodeURIComponent(webrtcPartnerEmailEl.value || '');
    const subject = encodeURIComponent('Laundry Bubbles connection code');
    const body = encodeURIComponent(webrtcLocalEl.value || '');
    const mailto = `mailto:${to}?subject=${subject}&body=${body}`;
    window.location.href = mailto;
  });

  // ===== Init =====
  loadProfile();
  loadPricing();
  loadFavorites();
  loadSettings();
  setStatus('App shell ready. Fill profile, pricing, and settings before real use.');
</script>
</body>
</html>
